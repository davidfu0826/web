<div class="page-header">
  <h1><%= t('.images') %></h1>
</div>

<% if @images.blank? %>
  <h3><%= t('.no_images') %></h3>
  <%= t('.no_images_lead') %>
<% end %>

<div class="row gallery-parent">
  <% @images.each do |image| %>
    <% if image.image_stored? %>
      <div class="col-sm-3 img-library">
        <% edit_button   = "<a class='btn btn-default' href='/images/#{image.id}/edit'>#{t(:delete)}</a>" %>
        <% delete_button = "<a class='btn btn-default' data-method='delete' href='/images/#{image.id}' rel='nofollow'>#{t(:destroy)}</a>" %>
        <%= link_to image.image.url,
            data: { toggle: "lightbox", gallery: "images", parent: ".gallery-parent",
              title: image.image_uid.split('/').last, footer: (edit_button + delete_button) }  do %>
          <%= image_tag image.image.thumb('300x300#').url, class: "img-responsive img-thumbnail" %>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>

<% content_for :sidebar do %>
  <% if can? :manage, Image %>
    <div class="row">
      <h3><%= t(:tools) %><span class="pull-right sidebar-glyph glyphicon glyphicon-wrench"></span></h3>
      <ul>
        <li><%= link_to t('.new_image'), new_image_path %></li>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <h3><%= t(:filter) %><span class="pull-right sidebar-glyph glyphicon glyphicon-search"></span></h3>
    <%= bootstrap_form_tag url: images_path, method: 'get' do |f| %>
      <p>
        <%= f.text_field :search, value: @search %>
        <%= f.collection_select :tag, @tags, :id, :title, { include_blank: true, label: t('.filter') }, { id: 'select2'} %>
        <%= f.submit %>
        <%= link_to t('.reset'), images_path %>
      </p>
    <% end %>
  </div>
<% end %>
